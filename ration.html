<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smoking Craving & Rationalization Checker</title>
  <style>
    :root{
      --primary-color:#4a6fa5;
      --secondary-color:#166088;
      --accent-color:#4fc3f7;
      --light-color:#f8f9fa;
      --dark-color:#343a40;
      --success-color:#28a745;
      --warning-color:#ffc107;
      --muted:#6c757d;
      --radius:8px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    *{box-sizing:border-box}
    body{margin:0;background:#f5f5f5;color:#222}
    .container{max-width:980px;margin:0 auto;padding:20px}
    header{background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:#fff;padding:14px 20px;position:sticky;top:0;z-index:100}
    .navbar{display:flex;justify-content:space-between;align-items:center}
    .logo{font-weight:700;text-decoration:none;color:white}
    .home-btn{background:rgba(255,255,255,0.15);color:white;padding:8px 12px;border-radius:6px;text-decoration:none}
    main{padding:18px 0}
    h1.section-title{text-align:center;color:var(--primary-color);margin:0 0 12px;font-size:1.6rem}
    .card{background:white;border-radius:var(--radius);padding:16px;box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-bottom:14px}
    label{font-weight:600;display:block;margin-bottom:8px}
    select,input[type="text"],textarea{width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;margin-bottom:12px}
    .inline-row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .inline-row > *{flex:1 1 auto}
    .radio-row{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    input[type="radio"],input[type="checkbox"]{margin-right:8px}
    button{background:var(--primary-color);color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
    button.secondary{background:#6c757d}
    .hidden{display:none}
    .success{color:var(--success-color);font-weight:700}
    .info{color:var(--primary-color);font-weight:600}
    .warning{color:var(--warning-color);font-weight:700}
    .explanation-box, .strategy-box{margin-top:10px}
    ul{padding-left:20px;margin:8px 0}
    footer{background:var(--dark-color);color:white;padding:16px;text-align:center;border-top-left-radius:8px;border-top-right-radius:8px}
    @media (max-width:640px){
      .inline-row{flex-direction:column}
    }
    /* focus styles for accessibility */
    a:focus, button:focus, input:focus, select:focus, textarea:focus {outline:3px solid rgba(79,195,247,0.4); outline-offset:2px}
    .muted{color:var(--muted)}
    .small{font-size:0.9rem}
    .countdown{font-weight:700;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <div class="container navbar" role="banner">
      <a class="logo" href="#">Smoking Craving & Rationalization Checker</a>
      <a class="home-btn" href="index.html">Back to Home</a>
    </div>
  </header>

  <main class="container" role="main">
    <section id="initial" class="card" aria-labelledby="initialTitle">
      <h1 id="initialTitle" class="section-title">How are you feeling right now?</h1>
      <form id="cravingForm" aria-describedby="formHelp" autocomplete="off">
        <label for="feelingSelect">What do you feel right now?</label>
        <select id="feelingSelect" required>
          <option value="">-- Select your feeling --</option>
          <option value="calm">Calm — no urge to smoke</option>
          <option value="some_urge">Some urge but manageable</option>
          <option value="strong_urge">Strong urge to smoke</option>
          <option value="very_strong">Very strong urge — almost uncontrollable</option>
        </select>

        <label>Would you be smoking at this moment if you could?</label>
        <div class="radio-row" role="radiogroup" aria-label="Would you smoke now?">
          <label><input type="radio" name="smokingNow" value="yes" required>Yes</label>
          <label><input type="radio" name="smokingNow" value="no">No</label>
        </div>

        <label for="walkDistance">How far would you walk right now to get a cigarette? (use this as an indicator of craving strength)</label>
        <select id="walkDistance" required>
          <option value="">-- Select distance --</option>
          <option value="0">0 m — would smoke immediately if given</option>
          <option value="50">50 m — very likely to try</option>
          <option value="200">200 m — likely</option>
          <option value="500">500 m — somewhat willing</option>
          <option value="1000">1 km or more</option>
          <option value="any">Any distance — will go far to smoke</option>
          <option value="-1">None — I wouldn't smoke even if offered</option>
        </select>

        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button type="submit">Continue</button>
          <button type="button" id="resetAll" class="secondary">Reset</button>
        </div>
        <div id="formHelp" class="muted small" style="margin-top:10px">Your answers are private in this session. Choose the option that best matches how you feel right now.</div>
      </form>
    </section>

    <!-- Support section for immediate urge / rationalization -->
    <section id="support-section" class="card hidden" aria-live="polite">
      <div id="immediate-track" class="">
        <h2 class="section-title">If you have an urge right now</h2>

        <div id="urge-summary" class="small muted"></div>

        <!-- If user indicates they would smoke now -->
        <div id="decided-block" class="hidden" aria-labelledby="decidedTitle">
          <h3 id="decidedTitle">Have you already decided to smoke, or are you trying to resist?</h3>
          <div class="radio-row" role="radiogroup" aria-label="Have you decided?">
            <label><input type="radio" name="decided" value="decided">I've decided / pretty sure I'll smoke</label>
            <label><input type="radio" name="decided" value="undecided">No — I'm trying to resist</label>
          </div>
        </div>

        <!-- Reason selection (rationalization) -->
        <div id="rationalization-prompt" class="hidden">
          <label for="reasonSelect" style="font-weight:600">Is there a reason or thought that makes you want to smoke right now?</label>
          <select id="reasonSelect">
            <option value="">-- Select a reason (optional) --</option>
            <option value="stress">I'm stressed or anxious</option>
            <option value="boredom">I'm bored</option>
            <option value="habit">It's part of my routine</option>
            <option value="social">I'm around other smokers</option>
            <option value="reward">I deserve a reward / break</option>
            <option value="focus">It helps me concentrate</option>
            <option value="identity">It's part of my identity</option>
            <option value="weight">It helps control weight</option>
            <option value="already">I've already slipped — what's the point?</option>
            <option value="just_craving">No real reason — just craving/withdrawal</option>
          </select>
          <div id="explanation" class="explanation-box" aria-live="polite"></div>
        </div>

        <!-- Withdrawal / mindfulness help -->
        <div id="withdrawal-help" class="hidden">
          <h4 class="info">If this is mainly withdrawal or strong craving</h4>
          <p class="small muted">Try a short urge-surfing or breathing exercise. These techniques reduce intensity quickly and safely.</p>
          <ul>
            <li><strong>Box breathing:</strong> inhale 4s — hold 4s — exhale 4s — hold 4s. Repeat 4 times.</li>
            <li><strong>5–4–3–2–1 grounding:</strong> Name 5 things you see, 4 you can touch, 3 you hear, 2 you smell, 1 you taste (or would like to).</li>
            <li><strong>Urge-surfing:</strong> Notice the urge as a wave — watch it rise, peak, and fall without acting on it.</li>
          </ul>
          <div style="display:flex;gap:10px;align-items:center">
            <button id="startBreath">Start 3-minute breathing timer</button>
            <div id="countdown" class="countdown small muted hidden" aria-live="polite"></div>
          </div>
        </div>

        <!-- If user says they've decided to smoke, show harm-reduction + debunks -->
        <div id="decided-advice" class="hidden">
          <h4 style="color:#b02a37">If you've already decided to smoke</h4>
          <p class="small muted">Before you do, consider these brief checks — they often change the immediate choice.</p>
          <ul>
            <li><strong>Ask: Why now?</strong> Is it stress, habit, or social pressure? If it's a rationalization, see the targeted debunk below.</li>
            <li><strong>Delay test:</strong> commit to a 5–15 minute delay — many urges subside in that window.</li>
            <li><strong>Harm-reduction:</strong> if you still smoke, try to make it safer (avoid smoking near children, indoors, share none).</li>
          </ul>
        </div>

        <div id="final-message" class="response-section hidden" style="margin-top:14px"></div>
      </div>

      <!-- Situational flow (no urge now but risk in situations) -->
      <div id="situational-flow" class="card hidden" aria-labelledby="situationalTitle">
        <h2 id="situationalTitle" class="section-title">Situations where you might smoke</h2>
        <form id="situationalForm" class="card" aria-describedby="sitHelp">
          <label>Select situations where you might smoke (even if you don't have an urge right now):</label>
          <label><input type="checkbox" name="situation" value="stress"> When I'm stressed or anxious</label>
          <label><input type="checkbox" name="situation" value="social"> When socializing / peer pressure</label>
          <label><input type="checkbox" name="situation" value="routine"> As part of a routine (coffee/break)</label>
          <label><input type="checkbox" name="situation" value="boredom"> When bored or idle</label>
          <label><input type="checkbox" name="situation" value="reward"> As a reward after finishing something</label>
          <label><input type="checkbox" name="situation" value="focus"> When needing to concentrate</label>
          <label><input type="checkbox" name="situation" value="emotion"> When feeling down or emotional</label>
          <label><input type="checkbox" name="situation" value="other"> Other</label>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button type="submit">Show guidance</button>
            <button type="button" id="backToForm" class="secondary">Back</button>
          </div>
          <div id="sitHelp" class="small muted" style="margin-top:8px">Pick all that apply — we'll give quick debunks and strategies for each.</div>
        </form>

        <div id="situation-strategies" class="strategy-box"></div>
      </div>

    </section>

  </main>

  <footer role="contentinfo">
    <div class="container">
      <p style="margin:0">&copy; 2025 Smoking Assessment Tools. Website by Kshiteesh Bhardwaj.</p>
    </div>
  </footer>

  <script>
    // ---- Data: explanations & situation strategies ----
    const explanations = {
      stress: {
        title: "Stress — the comfort illusion",
        text: [
          "Smoking might *feel* calming because it relieves nicotine withdrawal, not the stress itself.",
          "Try labeling the thought: 'I want to smoke to reduce stress' — this helps you see it as a habit-driven thought.",
          "Alternative: 2–3 minutes of focused breathing or a brief walk reduces stress-response chemicals reliably."
        ]
      },
      boredom: {
        title: "Boredom — stimulation seeking",
        text: [
          "Boredom creates a craving for novelty; smoking is a conditioned way to add novelty.",
          "Strategy: keep a short list of 5 quick tasks (call, stretch, joke, quick puzzle, drink water)."
        ]
      },
      habit: {
        title: "Habit — automatic loops",
        text: [
          "Many puffs are triggered by a cue (coffee, break, phone). Identifying the cue breaks the loop.",
          "Strategy: change one element of the cue (switch location of break, swap coffee with tea)."
        ]
      },
      social: {
        title: "Social/peer pressure",
        text: [
          "Smoking can feel like a social connector, but true connection doesn't require shared cigarettes.",
          "Strategy: hold a drink, offer to step out for a walk instead, or have a short refusal script prepared."
        ]
      },
      reward: {
        title: "Reward rationalization",
        text: [
          "Nicotine creates a brief sensation of reward, but it enforces dependency rather than genuine enjoyment.",
          "Strategy: substitute a healthy reward (song, snack, a 5-minute victory lap)."
        ]
      },
      focus: {
        title: "Focus / concentration myth",
        text: [
          "Perceived focus is often reversal of withdrawal fog. Hydration, short movement, and 10-minute task blocks help reliably.",
          "Strategy: set a 10-minute timer, drink water, chew gum while you work."
        ]
      },
      identity: {
        title: "Identity 'I'm a smoker'",
        text: [
          "Identity is changeable. 'I used to smoke' does not mean 'I always will'.",
          "Strategy: identify one behaviour you are proud of and anchor identity to that instead."
        ]
      },
      weight: {
        title: "Weight control worry",
        text: [
          "Smoking has small, unreliable effects on appetite and large negative health costs.",
          "Strategy: replace with small satiating snacks and mindful eating practices."
        ]
      },
      already: {
        title: "I've already slipped",
        text: [
          "One slip does not mean failure. The most effective strategy is to recommit immediately and learn from the trigger.",
          "Strategy: note what led to the slip and plan one concrete alternative next time."
        ]
      },
      just_craving: {
        title: "Just craving — withdrawal",
        text: [
          "Pure cravings are temporary and usually peak and fall within 10–20 minutes.",
          "Strategy: label the urge, do a breathing exercise for 3–5 minutes, or delay for 10 minutes and reassess."
        ]
      }
    };

    const situationStrategies = {
      stress: {
        title: "Stressed or anxious",
        debunk: "Smoking doesn't truly reduce stress — it briefly removes withdrawal discomfort. Healthier practices produce lasting stress reduction.",
        strategies: [
          "3-minute breathing or progressive muscle relaxation.",
          "Plan a quick physical activity (stairs, brisk walk).",
          "Write the stressor down and one action you can take about it."
        ]
      },
      social: {
        title: "Socializing / peer pressure",
        debunk: "Connection doesn't depend on smoking; refusing can increase self-respect and sometimes others' respect.",
        strategies: [
          "Prepare a polite refusal: 'No thanks, I don't smoke anymore.'",
          "Hold a drink or gum to occupy your hands.",
          "Suggest a non-smoking activity (walk, coffee, game)."
        ]
      },
      routine: {
        title: "Routine (coffee / break)",
        debunk: "Cravings tied to routines are conditioned responses, not real needs.",
        strategies: [
          "Change the routine (take break somewhere new).",
          "Pair your routine with a different action (stretch, short call).",
          "Delay: keep coffee but no cigarette — try a tea instead."
        ]
      },
      boredom: {
        title: "Boredom / idle times",
        debunk: "Boredom calls for stimulation — not nicotine.",
        strategies: [
          "List 5 quick tasks you can do when bored.",
          "Keep a small fidget (stress ball) handy.",
          "Switch environment if possible for 5–10 minutes."
        ]
      },
      reward: {
        title: "As a reward",
        debunk: "Nicotine rewards maintain dependence rather than reward you meaningfully over time.",
        strategies: [
          "Replace with short enjoyable rituals: favorite song, snack, or social recognition.",
          "Set a reward jar (save money instead of cigarettes) to visualize progress."
        ]
      },
      focus: {
        title: "When needing to focus",
        debunk: "Alertness from smoking often just reverses withdrawal fog — not a true cognitive boost.",
        strategies: [
          "Break work into 10-minute focused sprints with water and stretch breaks.",
          "Chew gum or use a short 'prep' ritual before starting tasks."
        ]
      },
      emotion: {
        title: "Low or emotional times",
        debunk: "Smoking provides a short mood lift and a long-term mood cycle of crashes and recovery disruption.",
        strategies: [
          "Call or message someone supportive.",
          "Use gentle self-talk and small pleasant activities (music, show clip).",
          "Schedule an emotional check-in: note feelings, length, and intensity."
        ]
      },
      other: {
        title: "Other situations",
        debunk: "Almost any trigger can be addressed with a healthier strategy than smoking.",
        strategies: [
          "Pause, name the trigger, and try a 2-minute alternative action.",
          "Remind yourself: 'I've handled this before without smoking.'"
        ]
      }
    };

    // ---- UI elements ----
    const form = document.getElementById('cravingForm');
    const supportSection = document.getElementById('support-section');
    const immediateTrack = document.getElementById('immediate-track');
    const situationalFlow = document.getElementById('situational-flow');
    const sitForm = document.getElementById('situationalForm');
    const situationStrategiesBox = document.getElementById('situation-strategies');
    const backToForm = document.getElementById('backToForm');

    // immediate-track elements
    const urgeSummary = document.getElementById('urge-summary');
    const decidedBlock = document.getElementById('decided-block');
    const rationalPrompt = document.getElementById('rationalization-prompt');
    const reasonSelect = document.getElementById('reasonSelect');
    const explanationBox = document.getElementById('explanation');
    const withdrawalHelp = document.getElementById('withdrawal-help');
    const decidedAdvice = document.getElementById('decided-advice');
    const finalMessage = document.getElementById('final-message');
    const startBreathBtn = document.getElementById('startBreath');
    const countdownEl = document.getElementById('countdown');

    // small helper: map distance to severity label and recommended delay
    function severityFromDistance(val) {
      if (val === '-1') return { level: 'resistant', label: "Won't smoke", delay: 0 };
      if (val === '0') return { level: 'immediate', label: "Immediate", delay: 15 };
      if (val === '50') return { level: 'very_high', label: "Very high", delay: 12 };
      if (val === '200') return { level: 'high', label: "High", delay: 10 };
      if (val === '500') return { level: 'moderate', label: "Moderate", delay: 7 };
      if (val === '1000') return { level: 'low', label: "Lower", delay: 5 };
      if (val === 'any') return { level: 'very_high', label: "Very high", delay: 15 };
      return { level: 'unknown', label: "Unknown", delay: 8 };
    }

    // Reset helper
    function resetAll() {
      form.reset();
      document.querySelectorAll('input[name="decided"]').forEach(i => i.checked = false);
      reasonSelect.value = "";
      explanationBox.innerHTML = "";
      countdownEl.textContent = "";
      countdownEl.classList.add('hidden');
      startBreathBtn.disabled = false;
      supportSection.classList.add('hidden');
      situationalFlow.classList.add('hidden');
      immediateTrack.classList.remove('hidden');
      situationStrategiesBox.innerHTML = "";
      finalMessage.classList.add('hidden');
    }

    document.getElementById('resetAll').addEventListener('click', resetAll);

    // form submit: decide which track to show
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const feeling = document.getElementById('feelingSelect').value;
      const smokingNow = document.querySelector('input[name="smokingNow"]:checked')?.value;
      const walkDistance = document.getElementById('walkDistance').value;

      // prepare UI
      supportSection.classList.remove('hidden');
      finalMessage.classList.add('hidden');
      decidedBlock.classList.add('hidden');
      rationalPrompt.classList.add('hidden');
      withdrawalHelp.classList.add('hidden');
      decidedAdvice.classList.add('hidden');
      situationalFlow.classList.add('hidden');
      situationStrategiesBox.innerHTML = "";

      const sev = severityFromDistance(walkDistance);
      urgeSummary.textContent = `Reported feeling: ${feeling.replace('_',' ')} • Willingness to walk: ${sev.label}.`;

      // Resilient: won't smoke and not willing to walk
      if (walkDistance === '-1' || (smokingNow === 'no' && walkDistance === '-1')) {
        immediateTrack.querySelector('#decided-block')?.classList.add('hidden');
        finalMessage.textContent = "You're showing strong resistance — well done. Keep using your strategies and review situational risks below if helpful.";
        finalMessage.classList.remove('hidden');
        // still allow situational exploration
        situationalFlow.classList.remove('hidden');
        return;
      }

      // If they indicate they'd smoke right now OR distance indicates immediate/very high
      if (smokingNow === 'yes' || ['0','50'].includes(walkDistance) || sev.level === 'immediate' || sev.level === 'very_high') {
        // show chosen flow for immediate urge
        decidedBlock.classList.remove('hidden');
        rationalPrompt.classList.remove('hidden');
        withdrawalHelp.classList.remove('hidden');
        decidedAdvice.classList.remove('hidden');
        // show suggested delay based on distance to try first
        const suggestedDelay = sev.delay;
        const delayHint = `Suggestion: if possible, delay for ${suggestedDelay} minutes (even a short delay reduces the chance you'll act on the urge).`;
        const dm = document.createElement('div');
        dm.className = 'small muted';
        dm.style.marginTop = '8px';
        dm.textContent = delayHint;
        if (!document.getElementById('delayHint')) {
          dm.id = 'delayHint';
          rationalPrompt.appendChild(dm);
        } else {
          document.getElementById('delayHint').textContent = delayHint;
        }
        return;
      }

      // Otherwise: calm now but situational risk or manageable urge
      if (feeling === 'calm' || smokingNow === 'no') {
        // show situational flow
        situationalFlow.classList.remove('hidden');
        immediateTrack.classList.remove('hidden');
        return;
      }

      // fallback: moderate urge path — show rationalization and withdrawal help
      rationalPrompt.classList.remove('hidden');
      withdrawalHelp.classList.remove('hidden');
    });

    // decide radio handler — if user chooses decided vs undecided
    document.querySelectorAll('input[name="decided"]').forEach(r => {
      r.addEventListener('change', (e) => {
        const v = e.target.value;
        if (v === 'decided') {
          // emphasize debunks & harm reduction
          decidedAdvice.classList.remove('hidden');
          withdrawalHelp.classList.remove('hidden');
        } else {
          decidedAdvice.classList.add('hidden');
          withdrawalHelp.classList.remove('hidden');
        }
      });
    });

    // reason select: show explanation/debunk + short actionable steps
    reasonSelect.addEventListener('change', () => {
      const val = reasonSelect.value;
      if (!val) {
        explanationBox.innerHTML = '';
        return;
      }
      const ex = explanations[val] || {title: 'Thought', text: ['Consider a short delay and one alternative action.']};
      let html = `<h4 style="margin:0 0 6px 0">${ex.title}</h4><ul>`;
      ex.text.forEach(t => html += `<li>${t}</li>`);
      html += '</ul>';
      // add one quick behaviour to try immediately
      html += `<div class="small muted"><strong>Try now:</strong> Choose one of these — breathe 2 minutes, walk 5 minutes, call a friend, or delay for 10 minutes.</div>`;
      explanationBox.innerHTML = html;
    });

    // breathing timer: 3 minutes default (180 seconds)
    let countdownTimer = null;
    function startCountdown(seconds) {
      clearInterval(countdownTimer);
      let remaining = seconds;
      countdownEl.classList.remove('hidden');
      countdownEl.textContent = `Timer: ${Math.ceil(remaining)}s remaining`;
      countdownTimer = setInterval(() => {
        remaining--;
        if (remaining <= 0) {
          clearInterval(countdownTimer);
          countdownEl.textContent = "Done — how do you feel now? Many urges reduce after the timer.";
          startBreathBtn.disabled = false;
        } else {
          countdownEl.textContent = `Timer: ${Math.ceil(remaining)}s remaining`;
        }
      }, 1000);
    }

    startBreathBtn.addEventListener('click', () => {
      startBreathBtn.disabled = true;
      // start a 3-minute (180s) breathing timer or 2 minutes depending on preference
      startCountdown(180);
    });

    // Situational form submission
    sitForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const choices = Array.from(document.querySelectorAll('input[name="situation"]:checked')).map(x => x.value);
      if (choices.length === 0) {
        situationStrategiesBox.innerHTML = `<div class="warning">Please select at least one situation to receive guidance.</div>`;
        return;
      }
      let html = '';
      choices.forEach(c => {
        const s = situationStrategies[c] || situationStrategies['other'];
        html += `<div style="margin-bottom:12px"><h3 style="margin:0 0 6px 0">${s.title}</h3>
                 <div><strong>Debunk:</strong> ${s.debunk}</div>
                 <ul>${s.strategies.map(it => `<li>${it}</li>`).join('')}</ul></div>`;
      });
      html += `<div class="success">Every time you practice these alternatives you build the habit of not needing cigarettes. Small wins add up.</div>`;
      situationStrategiesBox.innerHTML = html;
      // show a "return" option
      document.getElementById('backToForm').focus();
    });

    backToForm.addEventListener('click', () => {
      // show initial form to change selection
      resetAll();
    });

    // allow keyboard Enter on reasonSelect to show explanation (accessibility)
    reasonSelect.addEventListener('keyup', (e) => {
      if (e.key === 'Enter') reasonSelect.dispatchEvent(new Event('change'));
    });

    // page load: ensure reset state
    resetAll();

    // small accessibility: focus flow after supporting section reveal
    form.addEventListener('submit', () => {
      setTimeout(() => {
        // focus first relevant interactive element
        const decided = document.querySelector('input[name="decided"]');
        if (decided) decided.focus();
        else if (document.getElementById('reasonSelect')) document.getElementById('reasonSelect').focus();
      }, 50);
    });

  </script>
</body>
</html>
